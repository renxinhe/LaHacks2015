package com.wynd.grapher;
import java.awt.image.BufferedImage;
import java.io.IOException;
import java.util.ArrayList;

import javax.servlet.ServletOutputStream;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.github.sarxos.webcam.Webcam;

public class GrapherServlet extends HttpServlet {
	
	private boolean RUNNING = false;
	private ArrayList<BufferedImage> list;
	
	public void service(HttpServletRequest req, HttpServletResponse resp) throws IOException {
		resp.setContentType("text/plain");
		ServletOutputStream out = resp.getOutputStream();
		String action = req.getParameter("action");
		if( action != null){
			if(action.equals("start")){
				synchronized(this){
					if(!RUNNING){
						final Webcam webcam = Webcam.getDefault();
						list = new ArrayList<BufferedImage>();
				        if(webcam == null){
				        	out.println("false");
				        }else{
				            webcam.open();
							RUNNING = true;
							new Thread(new Runnable(){
								public void run(){
									while(true){
										synchronized(GrapherServlet.this){
											if(!RUNNING){
												break;
											}
										}

										
							            BufferedImage image = webcam.getImage();

							            // save image to PNG file
							            //ImageIO.write(image, "PNG", new File("test2.png"));
									}
								}
							});
				        }
					}
				}
			}
		}
	}

	
}
